#!/usr/bin/env bash
# bin/compile <BUILD_DIR> <CACHE_DIR> <ENV_DIR>

set -e
set -o pipefail

# Append indentation to match Heroku style.
indent () {
	sed -u 's/^/ /'
}

echo "-----> Found package.lua"

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
BIN_DIR=$BUILD_DIR/bin
PATH=$BIN_DIR:$PATH

echo "-----> Fetching lit"

mkdir -p $BIN_DIR
cd $BIN_DIR
curl -L https://github.com/luvit/lit/raw/master/get-lit.sh | sh
chmod +x $BIN_DIR/lit

echo "-----> Building luvit"

lit make lit://luvit/luvit
chmod +x $BIN_DIR/luvit